@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
    var medical = ViewBag.medicalProfiles;
}
<script type="text/javascript">
    $(function () {
        var detailsInJson = @Html.Raw(ViewBag.detailsInJson);
        $("#medical-profile").html(_.template($("#medical-profile-template").html(), {snippetList: detailsInJson}));
    });
</script>
<div align="center">
    <h2>
        @medical.MedicalProfileTemplate.MedicalProfileTemplateName
    </h2>
</div>
<div class="form-horizontal" id="medical-profile">
</div>
<script id="medical-profile-template" type="text/template">
    <% _.each(snippetList, function(snippet) { %>
        <% if (snippet.parentId == 0 && snippet.numofrows == undefined) { %>
            <% if (snippet.value == null) { %>
              <fieldset>
                  <div>
                      <legend><%= snippet.name %></legend>
                  </div>
                  <% } else { %>
                <div class="form-group">
                    <label class="col-md-4 control-label"><%= snippet.name %></label>
                    <div class="col-md-8 form-control-static">
                        <%= snippet.value %>
                    </div>
                </div>
              </fieldset>
    <% } %>
       <% } %>   
       <% if (snippet.numofrows != undefined) { 
            var childList = _.filter(snippetList, function(element) { return element.parentId == snippet.id});
       %>
            <%= _.template($("#table-template").html(), {snippet: snippet, snippetList: childList}) %>
       <% } %>
    <% }); %>
</script>

<script id="table-template" type="text/template">
    <h4><%= snippet.name %>
    </h4>
    <table class="table table-striped table-hover ">
        <thead>
            <tr>
                <% _.each(JSON.parse(snippet.columns), function(column, i){ %>
                    <th><%= column %></th>
                <% }); %>
            </tr>
        </thead>
        <tbody>
            <% 
                var numOfCols = JSON.parse(snippet.columns).length;
                for (var i = 0; i < snippet.numofrows; i++) { %>
            <tr>
                <% 
                    var indexInRow = 0;
                    _.each(snippetList, function(snippet, j) { %>
                    <% if (i*numOfCols + indexInRow == snippet.positionInTable) {
                        indexInRow++;
                    %>
                        <td><%= snippet.value %></td>
                    <% }
                }); %>
            </tr>
            <% } %>
        </tbody>
    </table>
</script>
